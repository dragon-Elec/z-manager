<?xml version="1.0" encoding="UTF-8"?>
<interface>
  <!-- 
    The file should ONLY contain the template definition.
    Cambalache can open this directly. Your Python code will load it.
  -->
  <template class="ConfigurePage" parent="GtkBox">
    <property name="orientation">vertical</property>

    <!-- Content Area: The Scrollable Container (Replaces AdwPreferencesPage) -->
    <child>
      <object class="GtkScrolledWindow">
        <property name="vexpand">true</property>
        <property name="hscrollbar-policy">never</property>
        <property name="vscrollbar-policy">automatic</property>
        
        <child>
          <object class="GtkBox">
            <property name="orientation">vertical</property>
            <property name="spacing">12</property>
            <property name="margin-top">12</property>
            <property name="margin-bottom">12</property>
            <property name="margin-start">12</property>
            <property name="margin-end">12</property>

            <!-- Group: Target Device Selector -->
            <child>
              <object class="AdwPreferencesGroup">
                <property name="title">Target Device</property>
                <property name="description">Select the ZRAM device you want to configure.</property>
                <child>
                  <object class="AdwComboRow" id="device_selector_row">
                    <property name="title">Current Device</property>
                    <property name="model">
                      <object class="GtkStringList">
                        <items>
                          <item>zram0</item>
                        </items>
                      </object>
                    </property>
                    <property name="selected">0</property>
                    <child type="suffix">
                        <object class="GtkButton" id="add_device_btn">
                            <property name="icon-name">list-add-symbolic</property>
                            <property name="valign">center</property>
                            <property name="tooltip-text">Add a new ZRAM device</property>
                            <style><class name="flat"/></style>
                        </object>
                    </child>
                    <child type="suffix">
                        <object class="GtkButton" id="remove_device_btn">
                            <property name="icon-name">user-trash-symbolic</property>
                            <property name="valign">center</property>
                            <property name="sensitive">false</property>
                            <property name="tooltip-text">Remove this device configuration</property>
                            <style><class name="flat"/></style>
                        </object>
                    </child>
                  </object>
                </child>
              </object>
            </child>

            <!-- Group 0: Profiles (Scenario Cards) -->
            <child>
              <object class="AdwPreferencesGroup">
                <property name="title">Configuration Profiles</property>
                <property name="description">Select a profile to optimize ZRAM for your workload.</property>
                <child>
                  <object class="GtkFlowBox" id="profiles_flowbox">
                    <property name="selection-mode">single</property>
                    <property name="max-children-per-line">3</property>
                    <property name="min-children-per-line">1</property>
                    <property name="valign">start</property>
                    <property name="halign">fill</property>
                    <property name="column-spacing">12</property>
                    <property name="row-spacing">12</property>
                    <property name="margin-bottom">12</property>
                    <property name="margin-top">12</property>
                  </object>
                </child>
              </object>
            </child>
        
            <!-- Group 1: Basic Settings -->
            <child>
              <object class="AdwPreferencesGroup">
                <property name="title">Basic Settings</property>
                <property name="description">Configure the primary zram0 device.</property>
                
                <child>
                  <object class="AdwComboRow" id="size_mode_row">
                    <property name="title">ZRAM Size</property>
                    <property name="model">
                      <object class="GtkStringList">
                        <items>
                          <item>50% of RAM</item>
                          <item>100% of RAM</item>
                          <item>Custom</item>
                        </items>
                      </object>
                    </property>
                    <property name="selected">0</property>
                  </object>
                </child>
                <child>
                  <object class="AdwEntryRow" id="custom_size_row">
                    <property name="title">Custom Size (e.g., 8G, 2048M)</property>
                    <property name="text"></property>
                    <property name="visible">false</property> 
                  </object>
                </child>
        
                <child>
                  <object class="AdwComboRow" id="algorithm_row">
                    <property name="title">Compression Algorithm</property>
                    <property name="model">
                      <object class="GtkStringList">
                        <items>
                          <item>zstd</item>
                          <item>lzo-rle</item>
                          <item>lz4</item>
                          <item>Custom...</item>
                        </items>
                      </object>
                    </property>
                    <property name="selected">0</property>
                  </object>
                </child>
                
                <child>
                  <object class="AdwEntryRow" id="custom_algorithm_row">
                    <property name="title">Custom Algorithm String</property>
                    <property name="tooltip-text">e.g., zstd(level=3) or zstd lzo-rle</property>
                    <property name="visible">false</property>
                  </object>
                </child>
        
                <child>
                  <object class="AdwSpinRow" id="priority_row">
                    <property name="title">Swap Priority</property>
                    <property name="subtitle">Higher values are used first. 100 is a good default.</property>
                    <property name="adjustment">
                      <object class="GtkAdjustment">
                        <property name="lower">0</property>
                        <property name="upper">32767</property>
                        <property name="value">100</property>
                        <property name="step-increment">1</property>
                      </object>
                    </property>
                  </object>
                </child>
              </object>
            </child>
            
            <!-- Group 2: Activation Rules (This is the host limit feature) -->
            <child>
              <object class="AdwPreferencesGroup">
                  <property name="title">Safety Limits</property>
                  <child>
                      <object class="AdwSwitchRow" id="host_memory_limit_switch">
                          <property name="title">Only enable if host has enough RAM</property>
                          <property name="subtitle">Prevents ZRAM setup on memory-limited systems</property>
                      </object>
                  </child>
                  <child>
                      <object class="AdwSpinRow" id="host_memory_limit_value">
                          <property name="title">Minimum Host RAM (MB)</property>
                          <property name="adjustment">
                              <object class="GtkAdjustment">
                                  <property name="lower">1024</property>
                                  <property name="upper">65536</property>
                                  <property name="value">2048</property>
                                  <property name="step-increment">512</property>
                              </object>
                          </property>
                          <property name="visible">false</property>
                      </object>
                  </child>
                  <child>
                      <object class="AdwEntryRow" id="resident_limit_row">
                          <property name="title">ZRAM Resident Memory Limit</property>
                          <property name="tooltip-text">Hard cap on physical RAM usage (e.g., 2G). Leave empty for none.</property>
                      </object>
                  </child>
              </object>
            </child>
        
            <!-- Group 3: Advanced Settings -->
            <child>
              <object class="AdwPreferencesGroup">
                <property name="title">Advanced Settings</property>
                <child>
                  <object class="AdwExpanderRow" id="advanced_expander">
                    <property name="title">Advanced Device Options</property>
                    <property name="subtitle">Configure writeback and filesystem usage</property>
                    
                    <child>
                      <object class="AdwActionRow">
                        <property name="title">Use as Filesystem (not Swap)</property>
                        <property name="subtitle">Formats the device for temporary storage.</property>
                        <child>
                            <object class="GtkSwitch" id="fs_mode_switch">
                              <property name="valign">center</property>
                            </object>
                        </child>
                      </object>
                    </child>
        
                    <child>
                      <object class="AdwComboRow" id="fs_type_row">
                        <property name="title">Filesystem Type</property>
                        <property name="model">
                          <object class="GtkStringList">
                            <items><item>ext2</item><item>ext4</item><item>btrfs</item></items>
                          </object>
                        </property>
                        <property name="visible">false</property>
                      </object>
                    </child>
        
                    <child>
                      <object class="AdwEntryRow" id="mount_point_row">
                        <property name="title">Mount Point</property>
                        <property name="text">/tmp/zram_fs</property>
                        <property name="visible">false</property>
                      </object>
                    </child>
        
                    <child>
                      <object class="AdwActionRow" id="writeback_row">
                        <property name="title">Writeback Device</property>
                        <property name="subtitle">None Selected</property>
                        <property name="tooltip-text">Device for incompressible pages (e.g., /dev/nvme0n1p3)</property>
                        <child>
                            <object class="GtkButton" id="select_writeback_btn">
                                <property name="label">Select Disk</property>
                                <property name="valign">center</property>
                                <style><class name="generated-button"/></style>
                                <signal name="clicked" handler="on_select_writeback_clicked"/>
                            </object>
                        </child>
                      </object>
                    </child>

                    <child>
                      <object class="AdwEntryRow" id="options_row">
                        <property name="title">Raw Options</property>
                        <property name="tooltip-text">Mount/Swapon flags (e.g., discard,noatime,mode=1777)</property>
                      </object>
                    </child>
                  </object>
                </child>

                <child>
                  <object class="AdwActionRow" id="raw_config_row">
                    <property name="title">Configuration File</property>
                    <property name="subtitle">/etc/systemd/zram-generator.conf</property>
                    <child>
                        <object class="GtkButton" id="open_folder_btn">
                            <property name="icon-name">folder-open-symbolic</property>
                            <property name="valign">center</property>
                            <property name="tooltip-text">Open containing folder</property>
                            <style><class name="flat"/></style>
                        </object>
                    </child>
                    <child>
                        <object class="GtkButton" id="open_file_btn">
                            <property name="icon-name">text-x-generic-symbolic</property>
                            <property name="valign">center</property>
                            <property name="tooltip-text">Open file in text editor</property>
                            <style><class name="flat"/></style>
                        </object>
                    </child>
                    <child>
                        <object class="GtkButton" id="open_example_btn">
                            <property name="icon-name">help-about-symbolic</property>
                            <property name="valign">center</property>
                            <property name="tooltip-text">Open example configuration</property>
                            <style><class name="flat"/></style>
                        </object>
                    </child>
                  </object>
                </child>
              </object>
            </child>
          </object>
        </child>
      </object>
    </child>
    
    <!-- Bottom Action Bar for Apply/Revert (Outside the scanned window) -->
    <child>
      <object class="GtkActionBar">
          <child type="start">
              <object class="GtkButton" id="revert_button">
                  <property name="label">Revert</property>
                  <style>
                      <class name="destructive-action"/>
                  </style>
                  <property name="sensitive">false</property>
                  <property name="tooltip-text">Undo changes and reload current system settings</property>
              </object>
          </child>
          <child type="end">
              <object class="GtkButton" id="apply_button">
                  <property name="label">Apply Changes</property>
                  <style>
                      <class name="suggested-action"/>
                  </style>
                  <property name="sensitive">false</property>
                  <property name="tooltip-text">Write configuration and restart ZRAM service</property>
              </object>
          </child>
      </object>
    </child>
  </template>
</interface>